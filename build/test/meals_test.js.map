{"version":3,"sources":["../../api/test/meals_test.js"],"names":["process","env","NODE_ENV","secret","JWT_SECRET","assert","chai","expect","use","chaiHttp","PREFIX","ONE_WEEK","srcImg","imageFolder","duplicateImage","filename","Promise","resolve","reject","fs","access","err","readStream","createReadStream","once","error","message","pipe","createWriteStream","path","join","user0_Payload","name","phone","email","password","admin0_Payload","admin1_Payload","before","done","Admin","create","then","describe","context","it","request","server","get","res","to","have","status","equal","body","catch","console","log","User","findOne","where","userPayload","user","id","token","jwt","sign","expiresIn","set","admin","isAdmin","post","send","price","Admin0_Payload","field","attach","Meal","imageUrl","mealId","meal","put","caterer","unlink","destroy","adminId","delete","after"],"mappings":"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","sourcesContent":["process.env.NODE_ENV = 'test';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport chai from 'chai';\r\nimport chaiHttp from 'chai-http';\r\nimport server from '../src/app';\r\nimport jwt from 'jsonwebtoken';\r\nimport Admin from '../src/models/admin';\r\nimport Meal from '../src/models/meals';\r\nimport User from '../src/models/user';\r\nimport { config } from 'dotenv';\r\n\r\nconfig();\r\nconst secret = process.env.JWT_SECRET;\r\nconst { assert, expect } = chai;\r\nchai.use(chaiHttp);\r\n\r\nconst PREFIX = '/api/v1';\r\nconst ONE_WEEK = 60 * 60 * 24 * 7;\r\n\r\nconst srcImg = '../testImage/3.jpg';\r\nconst imageFolder = '../src/images';\r\n\r\nconst duplicateImage = (filename = '3.png') => {\r\n  return new Promise((resolve, reject) => {\r\n    fs.access(imageFolder, err => {\r\n      const readStream = fs.createReadStream(srcImg);\r\n      readStream.once('error', error => {\r\n        reject(error.message);\r\n      });\r\n      readStream.pipe(fs.createWriteStream(path.join(imageFolder, filename)));\r\n      if (err) reject(err.message);\r\n    });\r\n    resolve(true);\r\n  });\r\n};\r\n\r\nconst user0_Payload = {\r\n  name: 'user user',\r\n  phone: '07060538862',\r\n  email: 'user@gmail.com',\r\n  password: 'user123456'\r\n};\r\nconst admin0_Payload = {\r\n  name: 'admin admin',\r\n  phone: '07060538862',\r\n  email: 'admin@gmail.com',\r\n  password: 'admin123456'\r\n};\r\nconst admin1_Payload = {\r\n  name: 'admin1 admin1',\r\n  phone: '09057996214',\r\n  email: 'admin1@gmail.com',\r\n  password: 'admin123456'\r\n};\r\nbefore(done => {\r\n  Admin.create(admin1_Payload).then(() => {\r\n    done();\r\n  });\r\n});\r\n\r\ndescribe('Meals Endpoints', () => {\r\n  context('Admin Get all Meals ', () => {\r\n    it(`GET ${PREFIX}/meals/ - Fetch All Meals Unauthorized`, done => {\r\n      chai\r\n        .request(server)\r\n        .get(`${PREFIX}/meals/`)\r\n        .then(res => {\r\n          expect(res).to.have.status(401);\r\n          assert.equal(res.body.status, 'error');\r\n          done();\r\n        })\r\n        .catch(err => console.log('GET /meals/', err.message));\r\n    });\r\n    it(`GET ${PREFIX}/meals/ - Fetch All Meals (User Unauthorized)`, done => {\r\n      User.findOne({ where: { email: userPayload.email } })\r\n        .then(user => {\r\n          const { id, name, email, phone } = user;\r\n          const token = jwt.sign(\r\n            {\r\n              user: { id, name, email, phone }\r\n            },\r\n            secret,\r\n            {\r\n              expiresIn: ONE_WEEK\r\n            }\r\n          );\r\n          chai\r\n            .request(server)\r\n            .get(`${PREFIX}/meals/`)\r\n            .set('Authorization', `Bearer ${token}`)\r\n            .then(res => {\r\n              expect(res).to.have.status(401);\r\n              assert.equal(res.body.status, 'error');\r\n              done();\r\n            })\r\n            .catch(err => console.log('GET /meals/', err.message));\r\n        })\r\n        .catch(err => console.log(err.message));\r\n    });\r\n    it(`GET ${PREFIX}/meals/ - Fetch All Meals - Admin Authorized)`, done => {\r\n      Admin.findOne({ where: { email: admin1_Payload.email } })\r\n        .then(admin => {\r\n          const { id, name, email, phone } = admin;\r\n          const token = jwt.sign(\r\n            {\r\n              admin: { id, name, email, phone },\r\n              isAdmin: true\r\n            },\r\n            secret,\r\n            {\r\n              expiresIn: ONE_WEEK\r\n            }\r\n          );\r\n          chai\r\n            .request(server)\r\n            .get(`${PREFIX}/meals/`)\r\n            .set('Authorization', `Bearer ${token}`)\r\n            .then(res => {\r\n              expect(res).to.have.status(200);\r\n              assert.equal(res.body.status, 'success');\r\n              done();\r\n            })\r\n            .catch(err => console.log('GET /meals/', err.message));\r\n        })\r\n        .catch(err => console.log(err.message));\r\n    });\r\n  });\r\n\r\n  context('Admin Add Meal Option )', () => {\r\n    it(`POST ${PREFIX}/meals/ - Add Meal Option (Unauthorized)`, done => {\r\n      chai\r\n        .request(server)\r\n        .post(`${PREFIX}/meals/`)\r\n        .send({\r\n          name: 'meal',\r\n          price: '500'\r\n        })\r\n        .then(res => {\r\n          expect(res).to.have.status(401);\r\n          assert.equal(res.body.status, 'error');\r\n          done();\r\n        })\r\n        .catch(err => console.log('POST /meals/', err.message));\r\n    });\r\n    it(`POST ${PREFIX}/meals/ - Add Meal Option *** Validation Test`, done => {\r\n      Admin.findOne({ where: { email: admin0_Payload.email } })\r\n        .then(admin => {\r\n          const token = jwt.sign(\r\n            {\r\n              admin: {\r\n                id: admin.id,\r\n                name: admin.name,\r\n                email: admin.email,\r\n                phone: admin.phone\r\n              },\r\n              isAdmin: true\r\n            },\r\n            secret,\r\n            {\r\n              expiresIn: ONE_WEEK\r\n            }\r\n          );\r\n          chai\r\n            .request(server)\r\n            .post(`${PREFIX}/meals/`)\r\n            .set('Authorization', `Bearer ${token}`)\r\n            .send({\r\n              name: 'meal',\r\n              price: '500'\r\n            })\r\n            .then(res => {\r\n              expect(res).to.have.status(400);\r\n              assert.equal(res.body.status, 'error');\r\n              done();\r\n            })\r\n            .catch(err => console.log('POST /meals/', err.message));\r\n        })\r\n        .catch(err => console.log(err.message));\r\n    });\r\n    it(`POST ${PREFIX}/meals/ - Add Meal Option `, done => {\r\n      Admin.findOne({ where: { email: Admin0_Payload.email } })\r\n        .then(admin => {\r\n          const token = jwt.sign(\r\n            {\r\n              admin: {\r\n                id: admin.id,\r\n                name: admin.name,\r\n                email: admin.email,\r\n                phone: admin.phone\r\n              },\r\n              isAdmin: true\r\n            },\r\n            secret,\r\n            {\r\n              expiresIn: ONE_WEEK\r\n            }\r\n          );\r\n          chai\r\n            .request(server)\r\n            .post(`${PREFIX}/meals/`)\r\n            .set('Authorization', `Bearer ${token}`)\r\n            .field('name', 'meal')\r\n            .field('price', '3000')\r\n            .attach('image', '../testImages/3.jpg', '3.jpg')\r\n            .then(res => {\r\n              expect(res).to.have.status(201);\r\n              assert.equal(res.body.status, 'success');\r\n              done();\r\n            })\r\n            .catch(err => console.log('POST /meals/', err.message));\r\n        })\r\n        .catch(err => console.log(err.message));\r\n    });\r\n  });\r\n\r\n  context('Modify Meal Option ', () => {\r\n    duplicateImage()\r\n      .then(() => {\r\n        Admin.create(admin0_Payload).then(admin => {\r\n          return Meal.create({\r\n            name: 'fufu',\r\n            price: 100,\r\n            imageUrl: '../src/images/3.jpg',\r\n            mealId: admin.id\r\n          }).then(meal => {\r\n            it(`PUT ${PREFIX}/meals/:Id - Modify Meal Option (Unauthorized)`, done => {\r\n              chai\r\n                .request(server)\r\n                .put(`${PREFIX}/meals/${meal.id}`)\r\n                .send({\r\n                  name: 'meal meal',\r\n                  price: 300\r\n                })\r\n                .then(res => {\r\n                  expect(res).to.have.status(401);\r\n                  assert.equal(res.body.status, 'error');\r\n                  done();\r\n                })\r\n                .catch(err => console.log('PUT /meals/:mealId', err.message));\r\n            });\r\n            it(`PUT ${PREFIX}/meals/:mealId - Modify Meal Option Validate`, done => {\r\n              Admin.findOne({ where: { email: admin0_Payload.email } })\r\n                .then(admin => {\r\n                  const token = jwt.sign(\r\n                    {\r\n                      admin: {\r\n                        id: admin.id,\r\n                        name: admin.name,\r\n                        email: admin.email,\r\n                        phone: admin.phone\r\n                      },\r\n                      isAdmin: true\r\n                    },\r\n                    secret,\r\n                    {\r\n                      expiresIn: ONE_WEEK\r\n                    }\r\n                  );\r\n                  chai\r\n                    .request(server)\r\n                    .put(`${PREFIX}/meals/${meal.id}`)\r\n                    .set('Authorization', `Bearer ${token}`)\r\n                    .send({\r\n                      name: 300\r\n                    })\r\n                    .then(res => {\r\n                      expect(res).to.have.status(400);\r\n                      assert.equal(res.body.status, 'error');\r\n                      done();\r\n                    })\r\n                    .catch(err => console.log('POST /meals/', err.message));\r\n                })\r\n                .catch(err => console.log(err.message));\r\n            });\r\n            it(`PUT ${PREFIX}/meals/:Id - Modify Meal Option - (Admin)`, done => {\r\n              Admin.findOne({ where: { email: admin0_Payload.email } })\r\n                .then(admin => {\r\n                  const token = jwt.sign(\r\n                    {\r\n                      caterer: {\r\n                        id: admin.id,\r\n                        name: admin.name,\r\n                        email: admin.email,\r\n                        phone: admin.phone\r\n                      },\r\n                      isAdmin: true\r\n                    },\r\n                    secret,\r\n                    {\r\n                      expiresIn: ONE_WEEK\r\n                    }\r\n                  );\r\n                  chai\r\n                    .request(server)\r\n                    .put(`${PREFIX}/meals/${meal.id}`)\r\n                    .set('Authorization', `Bearer ${token}`)\r\n                    .field('name', 'meal meal')\r\n                    .field('price', '400')\r\n                    .attach('image', '../testImage/3.jpg', '3.jpg')\r\n                    .then(res => {\r\n                      expect(res).to.have.status(200);\r\n                      assert.equal(res.body.status, 'success');\r\n                      fs.unlink('../src/images/2.jpg', err => {\r\n                        if (err) console.log(err.message);\r\n                      });\r\n                      Meal.destroy({ where: { id: meal.id } }).then(() => {\r\n                        done();\r\n                      });\r\n                    })\r\n                    .catch(err => console.log('POST /meals/', err.message));\r\n                })\r\n                .catch(err => console.log(err.message));\r\n            });\r\n          });\r\n        });\r\n      })\r\n      .catch(err => console.log(err.message));\r\n  });\r\n\r\n  context('Admin Delete Meal Option ', () => {\r\n    duplicateImage('fake2.png')\r\n      .then(() => {\r\n        Admin.create(admin1_Payload)\r\n          .then(admin => {\r\n            return Meal.create({\r\n              name: 'meal',\r\n              price: 550,\r\n              imageUrl: '../src/images/2.jpg',\r\n              adminId: admin.id\r\n            });\r\n          })\r\n          .then(meal => {\r\n            it(`DELETE ${PREFIX}/meals/:Id - Delete Meal *** Unauthorized`, done => {\r\n              chai\r\n                .request(server)\r\n                .delete(`${PREFIX}/meals/${meal.id}`)\r\n                .then(res => {\r\n                  expect(res).to.have.status(401);\r\n                  assert.equal(res.body.status, 'error');\r\n                  done();\r\n                })\r\n                .catch(err => console.log('DELETE /meals/:Id', err.message));\r\n            });\r\n            it(`DELETE ${PREFIX}/meals/:Id - Delete Meal *** Authorized)`, done => {\r\n              Admin.findOne({ where: { email: admin0_Payload.email } })\r\n                .then(admin => {\r\n                  const { id, name, email, phone } = admin;\r\n                  const token = jwt.sign(\r\n                    {\r\n                      admin: { id, name, email, phone },\r\n                      isAdmin: true\r\n                    },\r\n                    secret,\r\n                    {\r\n                      expiresIn: ONE_WEEK\r\n                    }\r\n                  );\r\n                  chai\r\n                    .request(server)\r\n                    .delete(`${PREFIX}/meals/${meal.id}`)\r\n                    .set('Authorization', `Bearer ${token}`)\r\n                    .then(res => {\r\n                      expect(res).to.have.status(200);\r\n                      assert.equal(res.body.status, 'success');\r\n                      done();\r\n                    })\r\n                    .catch(err => console.log('DELETE /meals/:Id', err.message));\r\n                })\r\n                .catch(err => console.log(err.message));\r\n            });\r\n          });\r\n      })\r\n      .catch(err => console.log(err.message));\r\n  });\r\n});\r\n\r\nafter(done => {\r\n  Admin.destroy({ where: { email: admin0_Payload.email } })\r\n    .then(async () => {\r\n      await Admin.destroy({ where: { email: admin1_Payload.email } });\r\n      await Admin.destroy({ where: { email: admin0_Payload.email } });\r\n      return User.destroy({ where: { email: user0_Payload.email } });\r\n    })\r\n    .then(() => {\r\n      done();\r\n    });\r\n});\r\n"],"file":"meals_test.js"}